[
  {
    "name": "Manager can do everything",
    "target": "subject.role.name == 'MANAGER'",
    "condition": "true"
  },
  {
    "name": "Referent can read client",
    "description": "Required when referent wants to create a file",
    "target": "subject.role.name == 'REFERENT' && action == 'READ_CLIENT'",
    "condition": "true"
  },
  {
    "name": "Referent can read his activity files",
    "target": "subject.role.name == 'REFERENT' && action == 'READ_FILE'",
    "condition": "resource.fileActivities.?[activity.id == #root.subject.activity.id].size() != 0"
  },
  {
    "name": "Referent can manage his activity",
    "target": "subject.role.name == 'REFERENT' && {'CREATE_ACTIVITY', 'UPDATE_ACTIVITY', 'DELETE_ACTIVITY'}.contains(action)",
    "condition": "resource.activity.id == subject.activity.id"
  },
  {
    "name": "Accountant can read activity which contains his tasks",
    "target": "subject.role.name == 'ACCOUNTANT' && 'READ_ACTIVITY' == action",
    "condition": "resource.fileTasks.?[referent.id == #root.subject.id].size != 0"
  },
  {
    "name": "The creator of the thing can delete the thing",
    "target": "{'DELETE_FILE', 'DELETE_ACTIVITY', 'DELETE_TASK'} == action",
    "condition": "resource.agent != null && resource.agent == subject.id"
  }
]
